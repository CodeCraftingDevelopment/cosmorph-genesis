name: Move issue to In Progress on commit

on:
  push:
    branches:
      - '**'  # toutes les branches

jobs:
  move_issue:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Detect issue IDs in commit messages
        id: extract
        run: |
          # Cherche refs #ID dans le dernier commit
          ISSUES=$(git log -1 --pretty=%B | grep -oE 'refs #[0-9]+')
          echo "Found issues: $ISSUES"
          echo "issues=$ISSUES" >> $GITHUB_OUTPUT

      - name: Move issues to In Progress
        if: steps.extract.outputs.issues != ''
        uses: peter-evans/move-project-card@v1
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          project-url: 'https://github.com/CodeCraftingDevelopment/cosmorph-genesis.git'
          column-name: 'In Progress'
          # Passer les IDs détectés
          issue-ids: ${{ steps.extract.outputs.issues }}
